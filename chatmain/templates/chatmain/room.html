{% load static %}
{% csrf_token %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Chat Room</title>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{% static 'chatmain/chat.css' %}">


</head>
<body>

<div class="status-bar" id="status-bar">[CONNECTING] :: SERVER: <span id="server-ip"></span> :: ROOM: <span id="room-display"></span></div>
<label style="margin-left:auto; display:flex; align-items:center; gap:6px; cursor:pointer; display: none">
    <input type="checkbox" id="theme-toggle">
    <span style="font-size: 13px;">Modern</span>
</label>

<div class="container">
    <div class="main-content">
        <div  class="chat-image-wrapper">
            <div class="chat-box">
                <div class="chat-log-title-container">
                    <h4 class="chat-log-title">Chat with AI Agent</h4>
                    <div class="tone-meter-wrapper" id="tm-id">
                        <span class="tone-meter-label">Negative</span>

                        <div id="tone-meter">
                            <!-- Will be dynamically filled with 7 squares -->
                        </div>
                        <span class="tone-meter-label">Positive</span>

                    </div>
                </div>
                <div id="chat-log" class="chat-log"></div>
                <div class="input-row">
                    <div id="reaction-section" class="reaction-section">
                        <div class="reaction-step reaction-initial">
                            <div class="reaction-title">For the last message you receive:</div>
                            <div class="reaction-buttons">
                                <button id="btn-off-topic" class="reaction-btn">I’m NOT okay with it's content.</button>
                                <button id="btn-tone" class="reaction-btn">I’m NOT okay with its tone.</button>
                                <button id="btn-aligned" class="reaction-btn">The tone aligns with my expectation.</button>
                            </div>
                        </div>

                        <div class="reaction-step reaction-rating" style="display: none;">
                            <div class="reaction-title" style="display: flex; justify-content: space-between; align-items: center;">
                                <button id="tone-back-btn" class="reaction-back-btn">← Back</button>
                                <span>How the tone aligns with your expectation:</span>
                                <span></span> <!-- spacer -->
                            </div>
                            <div id="tone-score-buttons" class="tone-rating-buttons"></div>
                        </div>
                    </div>
                    <div class="input-control-row">
                        <div id="chat-input-wrapper" class="input-wrapper">
                            <input id="chat-message-input" type="text" placeholder="Give order to adjust content or tone. Goal: align the tone to your expectation." class="typing-cursor">
                            <div id="input-overlay" class="input-overlay"></div>
                        </div>
                        <input id="chat-message-submit" type="button" value="Send">
                    </div>

                </div>
            </div>

            <div class="image-box" id="imgbbox">
                <div class="image-box-title-container" style="display: none">
                    <h4 class="image-box-title">Graph of Tones</h4>
                </div>
                <div id="chart-container" style="width: 100%; margin-bottom: 20px;">
                    <!--                <canvas id="neg-chart"></canvas>-->
                    <!--                <canvas id="neu-chart"></canvas>-->
                    <!--                <canvas id="pos-chart"></canvas>-->
                    <div id="polarity-text-description" class="polarity-description"></div>
                    <canvas id="polarity-bar-chart" height="90" ></canvas>

                    </br>
                    </br>
                    </br>
                    <span>The graph below shows in more detail how the tone of sentences is distributed in each answer.</span>
                    <canvas id="compound-curve-chart" ></canvas>
                    <canvas id="compound-bar-chart" style="display: none"></canvas>

                    <!--                <canvas id="ratio-bar" height="40" style="margin-top: 10px;"></canvas>-->
                    <!--                <canvas id="sum-bar" height="40" style="margin-bottom: 30px;"></canvas>-->

                </div>

                <div class="legend-section" style="display: none">
                    <div style="align-content: center;text-align: center;margin-bottom: 5px; margin-top: 5px;">Tone Meter</div>

                    <div class="legend-bar-wrapper">
                        <div class="legend-bar"></div>
                        <div id="legend-indicator"></div>
                    </div>
                    <div class="legend-labels">
                        <span>-1</span>
                        <span>0</span>
                        <span>+1</span>
                    </div>
                </div>

                <label style="font-size: 13px;margin-top: 10px;display: none ">
                    <input type="checkbox" id="colorblind-toggle">
                    Toggle to use none-red-green colors
                </label>
            </div>

        </div>


    </div>

</div>


<div id="refine-popup" class="refine-popup" style="display:none; position:absolute;">
    <button data-dir="positive">Be More Positive</button>
    <button data-dir="negative">Be More Negative</button>
</div>

<div id="consent-modal" class="modal" style="display:none;">
    <div class="modal-content">
        <h2 id="consent-title" style="margin-top:0;">Consent Form<br>for Online Surveys Involving Personal Data</h2>
        <div id="consent-text-wrapper" style="overflow-y: auto; max-height: 300px; margin-bottom: 10px; padding: 10px;">
            <div id="consent-text"></div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button id="consent-decline-btn" style="background-color: #ccc; color: #000;">Decline</button>
            <button id="consent-agree-btn">I Agree</button>
        </div>
    </div>
</div>

<div id="topic-modal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width: 600px;">
        <h3 id="topic-modal-progress"></h3>

        <div id="topic-modal-title"></div>

        <textarea id="topic-input" rows="3" placeholder="Type your topic here..." style="width: 100%; margin-top: 10px;"></textarea>
<!--        <div>Help us tag this topic:</div>
        <div id="topic-choice-row" class="choice-row">
            <div class="choice-square" data-topic="Politics">Politics</div>
            <div class="choice-square" data-topic="Pets">Pets</div>
            <div class="choice-square" data-topic="Education">Education</div>
            <div class="choice-square" data-topic="Political correctness">Political Correct</div>
            <div class="choice-square" data-topic="Europe">Europe</div>
            <div class="choice-square" data-topic="VVD">VVD</div>
        </div>-->

        <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
            <button id="topic-submit-btn">Submit</button>
        </div>
    </div>
</div>
{{ room_name|json_script:"room-name" }}
<script src="{% static 'chatmain/theme.js' %}"></script>

<script src="{% static 'chatmain/chatws.js' %}"></script>

<script src="{% static 'chatmain/chartplay.js' %}"></script>
<script src="{% static 'chatmain/chat.js' %}"></script>

</body>
</html>
